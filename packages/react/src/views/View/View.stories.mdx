import { fake, seed } from 'faker/locale/en_US'
import range from 'lodash/range'

import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs'

import { contextArgTypes } from '../../lib'
import fakeTitle from '../../lib/fakeTitle'
import iconSpriteUrl from '../../lib/storybookIconSpriteUrl'
import { View } from './View'

<Meta
  title="Views/View"
  component={View}
  argTypes={{
    main: {
      name: 'Main',
      control: { type: 'object' },
    },
    ...contextArgTypes,
  }}
  parameters={{
    viewMode: 'docs',
  }}
/>

export const ViewTemplate = (props) => <View {...props} />

export const learnMore = {
  link: 'Learn more.',
  href: 'https://github.com/OfficeDev/fluent-blocks#readme',
  external: true,
  targetBlank: true,
}

export const activate = {
  link: 'Activate.',
  actionId: 'link--activate',
}

# View

The `View` component organizes all patterns supported in this library into one
coherent “view” for the user to experience. A view renders an experience that
may have motion and interactivity but starts with the same content you
supply. Content will only change if the user triggers the change, and at
that time `View` will call its interaction callback with the update.

<Canvas withSource="none">
  <Story
    name="Intro"
    args={{
      main: {
        title: [{ text: 'Fluent Blocks' }],
        abstract: [
          {
            text: 'This is a demonstration of Fluent Blocks’ View component. ',
          },
          { text: fake('{{lorem.paragraph}}') },
        ],
        sections: range(4).map((s) => ({
          title: [{ text: fakeTitle(fake) }],
          blocks: [
            ...range(2).map(() => ({
              paragraph: range(3).map(() => ({
                text: fake('{{lorem.sentence}} '),
              })),
            })),
            ...(s === 0
              ? [
                  {
                    media: { label: 'Hello', illustration: 'hello' },
                    variant: 'narrow',
                    caption: [
                      { text: 'Figure caption: ' },
                      { text: fake('{{lorem.sentence}}') },
                    ],
                  },
                ]
              : []),
            {
              paragraph: range(3).map(() => ({
                text: fake('{{lorem.sentence}} '),
              })),
            },
          ],
          ...(s === 1 && {
            blocks: [
              {
                toolbar: {
                  menu: [
                    {
                      action: {
                        actionId: 'font',
                        label: 'Font',
                        iconOnly: true,
                        icon: 'text_font',
                      },
                    },
                    {
                      action: {
                        actionId: 'code',
                        label: 'Code',
                        iconOnly: true,
                        icon: 'code',
                      },
                    },
                    {
                      action: {
                        actionId: 'eye',
                        label: 'Eye',
                        iconOnly: true,
                        icon: 'eye',
                      },
                    },
                    {
                      action: {
                        actionId: 'stack',
                        label: 'Respond',
                        iconOnly: false,
                        icon: 'stack',
                      },
                    },
                    {
                      action: {
                        actionId: 'heart',
                        label: 'Connect',
                        iconOnly: false,
                        icon: 'heart',
                      },
                    },
                    {
                      action: {
                        actionId: 'accessibility',
                        label: 'Include',
                        iconOnly: false,
                        icon: 'accessibility',
                      },
                    },
                    {
                      action: {
                        actionId: 'chat',
                        label: 'Chat',
                        iconOnly: true,
                        icon: 'chat',
                      },
                    },
                    {
                      action: {
                        actionId: 'moon',
                        label: 'Moon',
                        iconOnly: true,
                        icon: 'weather_moon',
                      },
                    },
                    {
                      action: {
                        actionId: 'cat',
                        label: 'Cat',
                        iconOnly: true,
                        icon: 'animal_cat',
                      },
                    },
                    {
                      action: {
                        actionId: 'clock',
                        label: 'Clock',
                        iconOnly: false,
                        icon: 'clock',
                      },
                    },
                    {
                      action: {
                        actionId: 'origami',
                        label: 'Origami',
                        iconOnly: false,
                        icon: 'send',
                      },
                    },
                    {
                      action: {
                        actionId: 'tools',
                        label: 'Tools',
                        iconOnly: false,
                        icon: 'wrench',
                      },
                    },
                  ],
                },
              },
              {
                inputs: [
                  {
                    textInput: {
                      actionId: 'a1',
                      label: [{ text: fakeTitle(fake) }],
                      initialValue: fake(
                        '{{name.firstName}} {{name.lastName}}'
                      ),
                      after: { icon: 'person' },
                    },
                  },
                  {
                    textInput: {
                      actionId: 'a2',
                      label: [{ text: fakeTitle(fake) }],
                      inputType: 'email',
                      placeholder: 'username',
                      after: { text: '@live.com' },
                    },
                  },
                  {
                    textInput: {
                      actionId: 'a3',
                      label: [{ text: fakeTitle(fake) }],
                      inputType: 'tel',
                      initialValue: fake('000 x1829'),
                      before: { icon: 'call' },
                    },
                  },
                ],
              },
              {
                inputs: [
                  {
                    textInput: {
                      actionId: 'a4',
                      label: fakeTitle(fake),
                      description: fake('{{lorem.sentence}}'),
                    },
                  },
                ],
              },
              {
                radioGroup: {
                  actionId: 'b1',
                  label: [{ text: fakeTitle(fake) }],
                  description: fake('{{lorem.sentence}}'),
                  options: [
                    { label: [{ text: fakeTitle(fake) }], value: 'v1' },
                    { label: [{ text: fakeTitle(fake) }], value: 'v2' },
                  ],
                },
              },
              {
                table: {
                  caption: `${fakeTitle(fake)}`,
                  captionVisuallyHidden: true,
                  rowHeaderColumn: 'c1',
                  maxWidthVariant: 'textWidth',
                  minWidthVariant: 'fill',
                  columns: {
                    c1: { title: 'Name' },
                    c2: { title: 'Office' },
                    c3: { title: 'Email', hideable: true },
                  },
                  rows: range(8).reduce((acc, r) => {
                    acc[`r${r}`] = {
                      c1: {
                        cell: fake('{{name.firstName}} {{name.lastName}}'),
                      },
                      c2: {
                        cell: [
                          { icon: 'organization' },
                          { text: fake(' {{address.city}}') },
                        ],
                      },
                      c3: { cell: fake('{{internet.email}}') },
                    }
                    return acc
                  }, {}),
                },
              },
            ],
            sections: range(2).map((r) => ({
              title: [{ text: fakeTitle(fake) }],
              blocks: [
                ...range(3).map((q) => ({
                  paragraph: range(3).map(() => ({
                    text: fake('{{lorem.sentence}} '),
                  })),
                })),
                {
                  card: {
                    title: [
                      { text: `${fakeTitle(fake)} ` },
                      { icon: 'info', description: fake('{{lorem.sentence}}') },
                    ],
                    body: [
                      { paragraph: fake('{{lorem.paragraph}}') },
                      {
                        paragraph: [
                          { text: fake('{{lorem.sentence}} ') },
                          {
                            text: fake('{{lorem.sentence}}'),
                            description: fake('{{lorem.sentence}}'),
                          },
                          { text: fake(' {{lorem.sentence}} ') },
                          r % 2 === 0 ? learnMore : activate,
                        ],
                      },
                    ],
                    actions: [
                      {
                        actionId: `edit:card-${r}`,
                        label: 'Edit',
                        icon: 'edit',
                      },
                    ],
                  },
                },
              ],
            })),
          }),
        })),
      },
      themeName: 'light',
      accentScheme: 'teams',
      iconSpriteUrl,
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Intro" />

## Teams Toolkit tab

Here’s `View` rendering the Teams Toolkit tab boilerplate experience

<Canvas>
  <Story
    name="Teams Toolkit tab"
    args={{
      main: {
        title: 'Congratulations!',
        abstract: 'Your app is running in your local environment',
        message: { media: { label: 'Hello', illustration: 'hello' } },
        blocks: [
          {
            card: {
              title: 'How to get started',
              titleVisuallyHidden: true,
              body: [
                {
                  tabs: [
                    {
                      tab: { label: '1. Build your app locally' },
                      panel: [
                        { paragraph: 'Change this code', level: 2 },
                        {
                          paragraph: [
                            'The front end is a ',
                            { text: 'create-react-app', variant: 'code' },
                            '. The entry point is ',
                            { text: 'tabs/src/index.tsx', variant: 'code' },
                            '. Just save any file and this page will reload automatically.',
                          ],
                        },
                        {
                          paragraph: 'Get the current user',
                          level: 2,
                        },
                        {
                          paragraph:
                            'Access basic information about the user like this:',
                        },
                        {
                          caption:
                            'Javascript code for accessing the user’s basic information',
                          captionVisuallyHidden: true,
                          media: {
                            label:
                              'Typescript code for fetching Teams user credentials',
                            code: 'const credential = new TeamsUserCredential();\nconst user = await credential.getUserInfo();',
                          },
                        },
                        {
                          paragraph: 'Get the user’s profile photo',
                          level: 2,
                        },
                        {
                          paragraph:
                            'Click below to authorize this app to read your profile photo using Microsoft Graph.',
                        },
                        {
                          inputs: [
                            {
                              button: {
                                actionId: 'auth',
                                label: 'Authorize',
                                variant: 'primary',
                              },
                            },
                          ],
                          variant: 'narrow-block',
                        },
                      ],
                    },
                    {
                      tab: { label: '2. Provision & deploy to the cloud' },
                      panel: [
                        {
                          paragraph: 'Deploy to the cloud',
                          level: 2,
                        },
                        {
                          paragraph:
                            'Before publishing your app to Teams App Catalog, you may want to provision and deploy your app’s resources to the cloud to make sure your app will be running smoothly!',
                        },
                        {
                          paragraph: [
                            'To provision your resources, you can either use our CLI command ',
                            { text: 'teamsfx provision', variant: 'code' },
                            ' or apply “Teams: Provision in the cloud” in Command palette.',
                          ],
                        },
                        {
                          paragraph: [
                            'To deploy your app, you can either use our CLI command ',
                            { text: 'teamsfx deploy', variant: 'code' },
                            ' or apply “Teams: Deploy to the cloud” in Command palette.',
                          ],
                        },
                        {
                          media: {
                            light: 'https://i.ibb.co/LdW9rHH/deploy.png',
                            dark: 'https://i.ibb.co/LdW9rHH/deploy.png',
                            highContrast: 'https://i.ibb.co/LdW9rHH/deploy.png',
                            label:
                              'Screenshot of deploying in Visual Studio Code.',
                          },
                        },
                      ],
                    },
                    {
                      tab: { label: '3. Publish to Teams' },
                      panel: [
                        {
                          paragraph: 'Publish to Teams',
                          level: 2,
                        },
                        {
                          paragraph:
                            'Your app’s resources and infrastructure are deployed and ready? Publish and register your app to Teams app catalog to share your app with others in your organization!',
                        },
                        {
                          media: {
                            light: 'https://i.ibb.co/pj5VzYQ/publish.png',
                            dark: 'https://i.ibb.co/pj5VzYQ/publish.png',
                            highContrast:
                              'https://i.ibb.co/pj5VzYQ/publish.png',
                            label:
                              'Screenshot of publishing in Visual Studio Code.',
                          },
                        },
                      ],
                    },
                  ],
                  label: 'Steps to get started',
                  tabListVariant: 'center',
                },
              ],
            },
          },
        ],
      },
      accentScheme: 'teams',
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>
