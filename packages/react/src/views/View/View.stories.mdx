import range from 'lodash/range'
import { fake, seed } from 'faker/locale/en_US'
import fakeTitle from '../../lib/fakeTitle'
import { View } from './View'
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs'
import { contextArgTypes } from '../../lib'

import basicSpriteUrl from '@fluent-blocks/basic-icons/basic-icons.svg'

<Meta
  title="Views/View"
  component={View}
  argTypes={{
    main: {
      name: 'Main',
      control: { type: 'object' },
    },
    ...contextArgTypes,
  }}
  parameters={{
    viewMode: 'docs',
  }}
/>

export const ViewTemplate = (props) => <View {...props} />

# View

The `View` component organizes all patterns supported in this library into one
coherent “view” for the user to experience. A view renders an experience that
may have motion and interactivity but starts with the same content you
supply. Content will only change if the user triggers the change, and at
that time `View` will call its interaction callback with the update.

<Canvas withSource="none">
  <Story
    name="Intro"
    args={{
      main: {
        title: [{ text: 'Fluent Blocks' }],
        abstract: [
          {
            text: 'This is a demonstration of Fluent Blocks’ View component. ',
          },
          { text: fake('{{lorem.paragraph}}') },
        ],
        sections: range(4).map((s) => ({
          title: [{ text: fakeTitle(fake) }],
          blocks: range(3).map(() => ({
            paragraph: range(3).map(() => ({
              text: fake('{{lorem.sentence}} '),
            })),
          })),
          ...(s === 1 && {
            blocks: [
              {
                toolbar: {
                  items: [
                    {
                      type: 'action',
                      actionId: 'font',
                      label: 'Font',
                      iconOnly: true,
                      icon: 'text_font',
                    },
                    {
                      type: 'action',
                      actionId: 'code',
                      label: 'Code',
                      iconOnly: true,
                      icon: 'code',
                    },
                    {
                      type: 'action',
                      actionId: 'eye',
                      label: 'Eye',
                      iconOnly: true,
                      icon: 'eye',
                    },
                    {
                      type: 'action',
                      actionId: 'stack',
                      label: 'Respond',
                      iconOnly: false,
                      icon: 'stack',
                    },
                    {
                      type: 'action',
                      actionId: 'heart',
                      label: 'Connect',
                      iconOnly: false,
                      icon: 'heart',
                    },
                    {
                      type: 'action',
                      actionId: 'accessibility',
                      label: 'Include',
                      iconOnly: false,
                      icon: 'accessibility',
                    },
                    {
                      type: 'action',
                      actionId: 'chat',
                      label: 'Chat',
                      iconOnly: true,
                      icon: 'chat',
                    },
                    {
                      type: 'action',
                      actionId: 'moon',
                      label: 'Moon',
                      iconOnly: true,
                      icon: 'weather_moon',
                    },
                    {
                      type: 'action',
                      actionId: 'cat',
                      label: 'Cat',
                      iconOnly: true,
                      icon: 'animal_cat',
                    },
                    {
                      type: 'action',
                      actionId: 'clock',
                      label: 'Clock',
                      iconOnly: false,
                      icon: 'clock',
                    },
                    {
                      type: 'action',
                      actionId: 'origami',
                      label: 'Origami',
                      iconOnly: false,
                      icon: 'send',
                    },
                    {
                      type: 'action',
                      actionId: 'tools',
                      label: 'Tools',
                      iconOnly: false,
                      icon: 'wrench',
                    },
                  ],
                },
              },
              {
                inputs: [
                  {
                    type: 'text',
                    actionId: 'a1',
                    label: [{ text: fakeTitle(fake) }],
                    initialValue: fake('{{name.firstName}} {{name.lastName}}'),
                    after: { icon: 'person' },
                  },
                  {
                    type: 'text',
                    actionId: 'a2',
                    label: [{ text: fakeTitle(fake) }],
                    placeholder: 'username',
                    after: { text: '@live.com' },
                  },
                  {
                    type: 'text',
                    actionId: 'a3',
                    label: [{ text: fakeTitle(fake) }],
                    initialValue: fake(
                      '{{system.fileName}}.{{system.fileExt}}'
                    ),
                    before: { icon: 'document' },
                  },
                ],
              },
              {
                type: 'radio-group',
                actionId: 'b1',
                label: [{ text: `${fakeTitle(fake)}:` }],
                options: [
                  { label: [{ text: fakeTitle(fake) }], value: 'v1' },
                  { label: [{ text: fakeTitle(fake) }], value: 'v2' },
                ],
              },
              {
                media: { label: 'Hello', illustration: 'hello' },
                variant: 'narrow',
                caption: [
                  { text: 'Figure caption: ' },
                  { text: fake('{{lorem.sentence}}') },
                ],
              },
            ],
            sections: range(2).map(() => ({
              title: [{ text: fakeTitle(fake) }],
              blocks: [
                ...range(3).map(() => ({
                  paragraph: range(3).map(() => ({
                    text: fake('{{lorem.sentence}} '),
                  })),
                })),
                {
                  card: [
                    {
                      paragraph: fakeTitle(fake),
                      level: 3,
                    },
                    { paragraph: fake('{{lorem.paragraph}}') },
                  ],
                },
              ],
            })),
          }),
        })),
      },
      themeName: 'light',
      accentScheme: 'teams',
      basicSpriteUrl,
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Intro" />

## Teams Toolkit tab

Here’s `View` rendering the Teams Toolkit tab boilerplate experience

<Canvas>
  <Story
    name="Teams Toolkit tab"
    args={{
      main: {
        title: 'Congratulations!',
        abstract: 'Your app is running in your local environment',
        message: { media: { label: 'Hello', illustration: 'hello' } },
        blocks: [
          {
            card: [
              {
                tabs: [
                  {
                    tab: { label: '1. Build your app locally' },
                    panel: [
                      { paragraph: 'Change this code', level: 2 },
                      {
                        paragraph: [
                          'The front end is a ',
                          { text: 'create-react-app', variant: 'code' },
                          '. The entry point is ',
                          { text: 'tabs/src/index.tsx', variant: 'code' },
                          '. Just save any file and this page will reload automatically.',
                        ],
                      },
                      {
                        paragraph: 'Get the current user',
                        level: 2,
                      },
                      {
                        paragraph:
                          'Access basic information about the user like this:',
                      },
                      {
                        caption:
                          'Javascript code for accessing the user’s basic information',
                        captionHidden: true,
                        media: {
                          label:
                            'Typescript code for fetching Teams user credentials',
                          code: 'const credential = new TeamsUserCredential();\nconst user = await credential.getUserInfo();',
                        },
                      },
                      {
                        paragraph: 'Get the user’s profile photo',
                        level: 2,
                      },
                      {
                        paragraph:
                          'Click below to authorize this app to read your profile photo using Microsoft Graph.',
                      },
                      {
                        inputs: [
                          {
                            type: 'button',
                            actionId: 'auth',
                            label: 'Authorize',
                            variant: 'primary',
                          },
                        ],
                        variant: 'narrow-block',
                      },
                    ],
                  },
                  {
                    tab: { label: '2. Provision & deploy to the cloud' },
                    panel: [
                      {
                        paragraph: 'Deploy to the cloud',
                        level: 2,
                      },
                      {
                        paragraph:
                          'Before publishing your app to Teams App Catalog, you may want to provision and deploy your app’s resources to the cloud to make sure your app will be running smoothly!',
                      },
                      {
                        paragraph: [
                          'To provision your resources, you can either use our CLI command ',
                          { text: 'teamsfx provision', variant: 'code' },
                          ' or apply “Teams: Provision in the cloud” in Command palette.',
                        ],
                      },
                      {
                        paragraph: [
                          'To deploy your app, you can either use our CLI command ',
                          { text: 'teamsfx deploy', variant: 'code' },
                          ' or apply “Teams: Deploy to the cloud” in Command palette.',
                        ],
                      },
                      {
                        media: {
                          light: 'https://i.ibb.co/LdW9rHH/deploy.png',
                          dark: 'https://i.ibb.co/LdW9rHH/deploy.png',
                          'high-contrast':
                            'https://i.ibb.co/LdW9rHH/deploy.png',
                          label:
                            'Screenshot of deploying in Visual Studio Code.',
                        },
                      },
                    ],
                  },
                  {
                    tab: { label: '3. Publish to Teams' },
                    panel: [
                      {
                        paragraph: 'Publish to Teams',
                        level: 2,
                      },
                      {
                        paragraph:
                          'Your app’s resources and infrastructure are deployed and ready? Publish and register your app to Teams app catalog to share your app with others in your organization!',
                      },
                      {
                        media: {
                          light: 'https://i.ibb.co/pj5VzYQ/publish.png',
                          dark: 'https://i.ibb.co/pj5VzYQ/publish.png',
                          'high-contrast':
                            'https://i.ibb.co/pj5VzYQ/publish.png',
                          label:
                            'Screenshot of publishing in Visual Studio Code.',
                        },
                      },
                    ],
                  },
                ],
                label: 'Steps to get started',
                tabListVariant: 'center',
              },
            ],
          },
        ],
      },
      accentScheme: 'teams',
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>

## Props parsing & validation issues

As a first-class pattern, `View` will parse the content props you give it
and render any schema validation issues it encounters to the page in
development. In production, it will display an error message to the user and
call its error callback with the issues.

<Canvas withSource="none">
  <Story
    name="Props validation"
    args={{
      main: {
        title: [{ potato: 'This content won’t be valid.' }],
      },
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>
