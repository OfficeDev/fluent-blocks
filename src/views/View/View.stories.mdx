import range from 'lodash/range'
import { fake, seed } from 'faker/locale/en_US'
import { View } from './View'
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs'

<Meta
  title="Patterns/View"
  component={View}
  argTypes={{
    main: {
      name: 'Main',
      control: { type: 'object' },
    },
    dir: {
      name: 'Text direction',
      control: { type: 'inline-radio', labels: { ltr: '→', rtl: '←' } },
    },
    theme: {
      name: 'Theme variant',
      control: {
        type: 'inline-radio',
        labels: {
          light: 'Light',
          dark: 'Dark',
          'high-contrast': 'High contrast',
        },
      },
    },
  }}
  parameters={{
    viewMode: 'docs',
  }}
/>

export const fakeTitle = () => {
  const lowercase = fake('{{lorem.words}}')
  return lowercase.charAt(0).toUpperCase() + lowercase.slice(1)
}

export const ViewTemplate = (props) => <View {...props} />

# View

The `View` component organizes all patterns supported in this library into one
coherent “view” for the user to experience. A view renders an experience that
may have motion and interactivity but starts with the same content you
supply. Content will only change if the user triggers the change, and at
that time `View` will call its interaction callback with the update.

<Canvas withSource="none">
  <Story
    name="Intro"
    args={{
      main: {
        title: [{ text: 'Fluent React Patterns' }],
        abstract: [
          {
            text: 'This is a demonstration of Fluent React Patterns’ View component. ',
          },
          { text: fake('{{lorem.paragraph}}') },
        ],
        sections: range(4).map((s) => ({
          title: [{ text: fakeTitle(fake) }],
          blocks: range(3).map(() => ({
            paragraph: range(3).map(() => ({
              text: fake('{{lorem.sentence}} '),
            })),
          })),
          ...(s === 1 && {
            blocks: [
              {
                inputs: [
                  {
                    type: 'text',
                    actionId: 'a1',
                    label: [{ text: fakeTitle(fake) }],
                  },
                  {
                    type: 'text',
                    actionId: 'a2',
                    label: [{ text: fakeTitle(fake) }],
                  },
                  {
                    type: 'text',
                    actionId: 'a3',
                    label: [{ text: fakeTitle(fake) }],
                  },
                ],
              },
              {
                type: 'radio-group',
                actionId: 'b1',
                label: [{ text: fakeTitle(fake) }],
                options: [
                  { label: [{ text: fakeTitle(fake) }], value: 'v1' },
                  { label: [{ text: fakeTitle(fake) }], value: 'v2' },
                ],
              },
              {
                type: 'text',
                actionId: 'c1',
                multiline: true,
                label: [{ text: fakeTitle(fake) }],
              },
              {
                media: { illustration: 'hello' },
                variant: 'narrow',
                caption: [
                  { text: 'Figure caption: ' },
                  { text: fake('{{lorem.sentence}}') },
                ],
              },
            ],
            sections: range(2).map(() => ({
              title: [{ text: fakeTitle(fake) }],
              blocks: range(3).map(() => ({
                paragraph: range(3).map(() => ({
                  text: fake('{{lorem.sentence}} '),
                })),
              })),
            })),
          }),
        })),
      },
      dir: 'ltr',
      theme: 'light',
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Intro" />

## Teams Toolkit tab

Here’s `View` rendering the Teams Toolkit tab boilerplate experience

<Canvas>
  <Story
    name="Teams Toolkit tab"
    args={{
      main: {
        title: [{ text: 'Congratulations!' }],
        abstract: [{ text: 'Your app is running in your local environment' }],
        message: { media: { illustration: 'thanks' } },
        blocks: [
          {
            card: [
              {
                tabs: [
                  {
                    tab: { label: '1. Build your app locally' },
                    panel: [
                      { paragraph: [{ text: 'Change this code' }], level: 2 },
                      {
                        paragraph: [
                          { text: 'The front end is a ' },
                          { text: 'create-react-app', variant: 'code' },
                          { text: '. The entry point is ' },
                          { text: 'tabs/src/index.tsx', variant: 'code' },
                          {
                            text: '. Just save any file and this page will reload automatically.',
                          },
                        ],
                      },
                      {
                        paragraph: [{ text: 'Get the current user' }],
                        level: 2,
                      },
                      {
                        paragraph: [
                          {
                            text: 'Access basic information about the user like this:',
                          },
                        ],
                      },
                      {
                        caption: [
                          {
                            text: 'Javascript code for accessing the user’s basic information',
                          },
                        ],
                        captionHidden: true,
                        media: {
                          code: 'const credential = new TeamsUserCredential();\nconst user = await credential.getUserInfo();',
                        },
                      },
                      {
                        paragraph: [{ text: 'Get the user’s profile photo' }],
                        level: 2,
                      },
                      {
                        paragraph: [
                          {
                            text: 'Click below to authorize this app to read your profile photo using Microsoft Graph.',
                          },
                        ],
                      },
                      {
                        inputs: [
                          {
                            type: 'button',
                            actionId: 'auth',
                            label: 'Authorize',
                            variant: 'primary',
                          },
                        ],
                        variant: 'narrow-block',
                      },
                    ],
                  },
                  {
                    tab: { label: '2. Provision and deploy to the cloud' },
                    panel: [
                      {
                        paragraph: [{ text: 'Deploy to the cloud' }],
                        level: 2,
                      },
                      {
                        paragraph: [
                          {
                            text: 'Before publishing your app to Teams App Catalog, you may want to provision and deploy your app’s resources to the cloud to make sure your app will be running smoothly!',
                          },
                        ],
                      },
                      {
                        paragraph: [
                          {
                            text: 'To provision your resources, you can either use our CLI command ',
                          },
                          { text: 'teamsfx provision', variant: 'code' },
                          {
                            text: ' or apply “Teams: Provision in the cloud” in Command palette.',
                          },
                        ],
                      },
                      {
                        paragraph: [
                          {
                            text: 'To deploy your app, you can either use our CLI command ',
                          },
                          { text: 'teamsfx deploy', variant: 'code' },
                          {
                            text: ' or apply “Teams: Deploy to the cloud” in Command palette.',
                          },
                        ],
                      },
                      {
                        media: {
                          light: 'https://i.ibb.co/LdW9rHH/deploy.png',
                          dark: 'https://i.ibb.co/LdW9rHH/deploy.png',
                          'high-contrast':
                            'https://i.ibb.co/LdW9rHH/deploy.png',
                          label:
                            'Screenshot of deploying in Visual Studio Code.',
                        },
                      },
                    ],
                  },
                ],
                label: 'Steps to get started',
                tabListVariant: 'center',
              },
            ],
          },
        ],
      },
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>

## Props parsing & validation issues

As a first-class pattern, `View` will parse the content props you give it
and render any schema validation issues it encounters to the page in
development. In production, it will display an error message to the user and
call its error callback with the issues.

<Canvas withSource="none">
  <Story
    name="Props validation"
    args={{
      main: {
        title: [{ potato: 'This content won’t be valid.' }],
      },
    }}
  >
    {seed(1234) || ViewTemplate.bind({})}
  </Story>
</Canvas>
